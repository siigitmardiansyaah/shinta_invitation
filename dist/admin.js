(()=>{var T=(()=>{let i=l=>String(l).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),f=(l,c)=>{let y=null;y=setTimeout(()=>{l(),clearTimeout(y),y=null},c)};return{copy:async(l,c=null,y=1500)=>{let A=l.getAttribute("data-copy");if(!A||A.length===0){alert("Nothing to copy");return}l.disabled=!0;try{await navigator.clipboard.writeText(A)}catch{l.disabled=!1,alert("Failed to copy");return}let u=l.innerHTML;l.innerHTML=c||'<i class="fa-solid fa-check"></i>',f(()=>{l.disabled=!1,l.innerHTML=u},y)},timeOut:f,escapeHtml:i,base64Encode:l=>{let y=new TextEncoder().encode(l);return window.btoa(String.fromCharCode(...y))},base64Decode:l=>{let c=new TextDecoder,y=Uint8Array.from(window.atob(l),A=>A.charCodeAt(0));return c.decode(y)},disableButton:(l,c="Loading")=>{l.disabled=!0;let y=l.innerHTML;return l.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${c}`,{restore:()=>{l.innerHTML=y,l.disabled=!1}}},disableCheckbox:l=>{l.disabled=!0;let c=document.querySelector(`label[for="${l.id}"]`),y=c.innerHTML;return c.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${y}`,{restore:()=>{c.innerHTML=y,l.disabled=!1}}},parseUserAgent:l=>{let c=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],y=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],A=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],u=c.find($=>$.regex.test(l))?.type||"Unknown",k=y.find($=>$.regex.test(l))?.name||"Unknown",n=A.find($=>$.regex.test(l)),b=n&&l.match(n.regex)?.[1]?.replace(/_/g,".")||"",E=n?n.name:"Unknown";return b=b?`${E} ${b}`:E,`${k} ${u} ${b}`}}})();var G={tab:g=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(g)),modal:g=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(g))};var S=(()=>{let i=(u,k,n)=>({code:u,data:k,error:n}),f=(u=0)=>({love:u}),g=({uuid:u,own:k,name:n,presence:b,comment:E,created_at:$,is_admin:H,ip:s,user_agent:t,comments:w,like:e})=>({uuid:u,own:k,name:n,presence:b,comment:E,created_at:$,is_admin:H??!1,ip:s,user_agent:t,comments:w?.map(g)??[],like:f(e?.love??0)});return{uuidResponse:({uuid:u})=>({uuid:u}),baseResponse:i,tokenResponse:({token:u})=>({token:u}),statusResponse:({status:u})=>({status:u}),commentResponse:({name:u,presence:k,comment:n,is_admin:b,created_at:E})=>({name:u,presence:k,comment:n,is_admin:b,created_at:E}),likeCommentResponse:f,getCommentResponse:g,getCommentsResponse:u=>u.map(g),commentShowMore:(u,k=!1)=>({uuid:u,show:k}),postCommentRequest:(u,k,n,b)=>({id:u,name:k,presence:n,comment:b}),postSessionRequest:(u,k)=>({email:u,password:k}),updateCommentRequest:(u,k)=>({presence:u,comment:k})}})();var L=i=>{let f=(d=null)=>{let p=JSON.parse(localStorage.getItem(i));return d?p[String(d)]:p},g=(d,p)=>{let l=f();l[String(d)]=p,localStorage.setItem(i,JSON.stringify(l))},r=d=>Object.keys(f()).includes(String(d)),m=d=>{if(!r(d))return;let p=f();delete p[String(d)],localStorage.setItem(i,JSON.stringify(p))},o=()=>localStorage.setItem(i,"{}");return localStorage.getItem(i)||o(),{set:g,get:f,has:r,clear:o,unset:m}};var O="GET",K="PUT",F="POST",D="PATCH",X="DELETE",N=200,V=201,ne=500,B=(i,f)=>{let g=new AbortController,r=document.body.getAttribute("data-url"),m={signal:g.signal,method:String(i).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return window.addEventListener("offline",()=>g.abort()),window.addEventListener("popstate",()=>g.abort()),window.addEventListener("beforeunload",()=>g.abort()),r.slice(-1)==="/"&&(r=r.slice(0,-1)),{send(o=null){return fetch(r+f,m).then(d=>d.json().then(p=>{if(d.status>=ne&&(p.message??p[0]))throw new Error(p.message??p[0]);if(p.error)throw new Error(p.error[0]);return o&&(p.data=o(p.data)),S.baseResponse(p.code,p.data,p.error)})).catch(d=>{if(d.name==="AbortError")return console.warn("Fetch abort:",d),d;throw alert(d),new Error(d)})},download(){return fetch(r+f,m).then(o=>{if(o.status!==N)return!1;let d=document.querySelector("a[download]");d&&document.body.removeChild(d);let p=o.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return o.blob().then(l=>{let c=document.createElement("a"),y=window.URL.createObjectURL(l);return c.href=y,c.download=p,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(y),!0})}).catch(o=>{if(o.name==="AbortError")return console.warn("Fetch abort:",o),o;throw alert(o),new Error(o)})},token(o){return o.split(".").length===3?(m.headers.append("Authorization","Bearer "+o),this):(m.headers.append("x-access-key",o),this)},body(o){return m.body=JSON.stringify(o),this}}};var x=(()=>{let i=null,f=()=>i.get("token"),g=c=>i.set("token",c),r=c=>B(F,"/api/session").body(c).send(S.tokenResponse).then(y=>(y.code===N&&g(y.data.token),y.code===N),()=>!1),m=()=>i.unset("token"),o=()=>String(f()??".").split(".").length===3;return{init:()=>{i=L("session")},guest:()=>B(O,"/api/config").token(f()).send().then(c=>{if(c.code!==N)throw new Error("failed to get config.");let y=L("config");for(let[A,u]of Object.entries(c.data))y.set(A,u);return c}),login:r,logout:m,decode:()=>{if(!o())return null;try{return JSON.parse(window.atob(f().split(".")[1]))}catch{return null}},isAdmin:o,setToken:g,getToken:f}})();var j=(()=>{let i=null,f=async d=>{let p=T.disableButton(d),l=document.getElementById("loginEmail"),c=document.getElementById("loginPassword");l.disabled=!0,c.disabled=!0,await x.login(S.postSessionRequest(l.value,c.value))&&(l.value=null,c.value=null,G.modal("mainModal").hide()),p.restore(),l.disabled=!1,c.disabled=!1},g=()=>{i.clear(),x.logout(),G.modal("mainModal").show()};return{init:()=>{i=L("user")},login:f,clearSession:g,getDetailUser:()=>B(O,"/api/user").token(x.getToken()).send().then(d=>{if(d.code!==N)throw new Error("failed to get user.");return Object.entries(d.data).forEach(([p,l])=>i.set(p,l)),d},d=>(g(),d)),getUserStorage:()=>i}})();var Y=(()=>{let i=(r,m)=>{document.querySelectorAll(".navbar button").forEach(o=>{o.classList.contains("active")&&o.classList.remove("active")}),G.tab(m).show(),r.classList.add("active")};return{buttonNavHome:r=>{i(r,"button-home")},buttonNavSetting:r=>{i(r,"button-setting")}}})();var J=(()=>{let i={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},f=["#ffffff","#f8f9fa"],g=["#000000","#212529"],r=!1,m=null,o=null,d=()=>m.set("active","light"),p=()=>m.set("active","dark"),l=E=>{let $=o.getAttribute("content");o.setAttribute("content",E.some(H=>H===$)?i[$]:$)},c=()=>{d(),document.documentElement.setAttribute("data-bs-theme","light"),l(g)},y=()=>{p(),document.documentElement.setAttribute("data-bs-theme","dark"),l(f)},A=(E=null,$=null)=>{let H=m.get("active")==="dark";return E&&$?H?E:$:H};return{init:()=>{switch(m=L("theme"),o=document.querySelector('meta[name="theme-color"]'),m.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?p():d()),document.documentElement.getAttribute("data-bs-theme")){case"dark":p();break;case"light":d();break;default:r=!0}A()?y():c()},spyTop:()=>{let E=H=>H.filter(s=>s.isIntersecting).forEach(s=>{let t=s.target.classList.contains("bg-white-black")?A(g[0],f[0]):A(g[1],f[1]);o.setAttribute("content",t)}),$=new IntersectionObserver(E,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(H=>$.observe(H))},change:()=>A()?c():y(),isDarkMode:A,isAutoMode:()=>r}})();var Q=(()=>{let i=null,f=!0,g=()=>f,r=u=>new Promise(k=>{let n=parseFloat(i.style.opacity),b=null,E=u?.05:-.05,$=u?1:0;b=setInterval(()=>{n=Math.max(0,Math.min(1,n+E)),i.style.opacity=n.toFixed(2),n===$&&(k(),clearInterval(b),b=null)},10)}),m=()=>{let u=i.firstElementChild.firstElementChild;u.classList.remove("bg-success"),u.classList.add("bg-danger"),u.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},o=()=>{let u=i.firstElementChild.firstElementChild;u.classList.remove("bg-danger"),u.classList.add("bg-success"),u.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},d=async()=>{await r(!1),m()},p=()=>{let u=null;u=setTimeout(()=>{clearTimeout(u),u=null,f&&d()},3e3)},l=()=>{let u=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"].join(", ");document.querySelectorAll(u).forEach(k=>{k.dispatchEvent(new Event(g()?"online":"offline")),k.setAttribute("data-offline-disabled",g()?"false":"true"),k.tagName==="BUTTON"?g()?k.classList.remove("disabled"):k.classList.add("disabled"):g()?k.removeAttribute("disabled"):k.setAttribute("disabled","true")})},c=()=>{f=!1,m(),r(!0),l()},y=()=>{f=!0,o(),p(),l()};return{init:()=>{window.addEventListener("online",y),window.addEventListener("offline",c),i=document.getElementById("offline-mode"),i.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:g}})();var _=(()=>{let i=null,f=null,g=null,r=null,m=null,o=null,d=250,p=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,l=e=>([["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']].forEach(h=>{let v=h[0],P=h[1];e=e.replace(new RegExp(`\\${v}(?=\\S)(.*?)(?<!\\s)\\${v}`,"gs"),P)}),e),c=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${g.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,y=e=>{let a=`<div class="d-flex flex-wrap justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(r.get("can_reply")===!0||r.get("can_reply")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),f.has(e.uuid)&&(r.get("can_edit")===!0||r.get("can_edit")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),x.isAdmin()?a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:f.has(e.uuid)&&(r.get("can_delete")===!0||r.get("can_delete")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),a+="</div>",a},A=(e,a)=>{let h=o.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${a.join(",")}" data-show="${h?"true":"false"}" role="button" class="me-auto ms-1 py-0">${h?"Hide replies":`Show replies (${a.length})`}</a>`},u=e=>`
        <div class="d-flex flex-wrap justify-content-between align-items-center" id="button-${e.uuid}">
            ${y(e)}
            ${e.comments.length>0?A(e.uuid,e.comments.map(a=>a.uuid)):""}
            ${c(e)}
        </div>`,k=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(e.ip)} ${m.has(e.ip)?`<strong>${m.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${T.parseUserAgent(T.escapeHtml(e.user_agent))}</p>
        </div>`,n=(e,a)=>a?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${o.get("hidden").find(h=>h.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,b=(e,a)=>e.is_admin?`<strong class="me-1">${T.escapeHtml(i.get("name")??r.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:a?`<strong class="me-1">${T.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${T.escapeHtml(e.name)}</strong>`,E=(e,a)=>{let h=l(T.escapeHtml(e.comment)),v=h.length>d;return`
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${b(e,a)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${v?`data-comment="${T.base64Encode(h)}"`:""} id="content-${e.uuid}">${v?h.slice(0,d)+"...":h}</p>
        ${v?`<p class="mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},$=(e,a)=>`
        <div ${n(e,a)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">
            ${E(e,a)}
            </div>
            ${k(e)}
            ${u(e)}
            <div id="reply-content-${e.uuid}">${e.comments.map(h=>H(h)).join("")}</div>
        </div>`,H=e=>$(e,!1);return{init:()=>{i=L("user"),f=L("owns"),g=L("likes"),r=L("config"),m=L("tracker"),o=L("comment")},renderEdit:(e,a)=>{let h=document.createElement("div");return h.classList.add("my-2"),h.id=`inner-${e}`,h.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</label>
        ${document.getElementById(e).getAttribute("data-parent")==="true"&&!x.isAdmin()?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${a?"selected":""}>Datang</option>
            <option value="2" ${a?"":"selected"}>Berhalangan</option>
        </select>`:""}
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,h},renderReply:e=>{let a=document.createElement("div");return a.classList.add("my-2"),a.id=`inner-${e}`,a.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</label>
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,a},renderLoading:p,renderReadMore:A,renderInnerContent:H,renderContent:e=>$(e,!0),convertMarkdownToHTML:l,maxCommentLength:d}})();var se=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var Z=i=>{if(!window.confetti)return;let f=Date.now()+25,g=Math.max(.3,Math.min(1,i.getBoundingClientRect().top/window.innerHeight+.2)),r=se(),m=["#FF69B4","#FF1493"];(function o(){m.forEach(d=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[r],origin:{x:0,y:g},zIndex:1057,colors:[d]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[r],origin:{x:1,y:g},zIndex:1057,colors:[d]})}),Date.now()<f&&requestAnimationFrame(o)})()};var W=(()=>{let i=null,f=async m=>{let o=m.firstElementChild,d=m.lastElementChild,p=m.getAttribute("data-uuid"),l=parseInt(o.getAttribute("data-count-like"));m.disabled=!0,i.has(p)?await B(D,"/api/comment/"+i.get(p)).token(x.getToken()).send(S.statusResponse).then(c=>{c.data.status&&(i.unset(p),d.classList.remove("fa-solid","text-danger"),d.classList.add("fa-regular"),o.setAttribute("data-count-like",String(l-1)))}):await B(F,"/api/comment/"+p).token(x.getToken()).send(S.uuidResponse).then(c=>{c.code===V&&(i.set(p,c.data.uuid),d.classList.remove("fa-regular"),d.classList.add("fa-solid","text-danger"),o.setAttribute("data-count-like",String(l+1)))}),o.innerText=o.getAttribute("data-count-like"),m.disabled=!1};return{init:()=>{i=L("likes")},love:f,tapTap:async m=>{if(!navigator.onLine)return;let o=Date.now(),d=o-parseInt(m.getAttribute("data-tapTime")),p=m.id.replace("body-content-",""),l=d<300&&d>0,c=!i.has(p)&&m.getAttribute("data-liked")!=="true";if(l&&c){navigator.vibrate&&navigator.vibrate(100),Z(m);let y=document.querySelector(`[onclick="undangan.comment.like.love(this)"][data-uuid="${p}"]`);m.setAttribute("data-liked","true"),await f(y),m.setAttribute("data-liked","false")}m.setAttribute("data-tapTime",o)}}})();var R=(()=>{let i=10,f=0,g=0,r=null,m=null,o=null,d=null,p=e=>{i=Number(e)},l=()=>i,c=()=>f,y=()=>g,A=()=>m.classList.contains("disabled")?null:m.classList.add("disabled"),u=()=>m.classList.contains("disabled")?m.classList.remove("disabled"):null,k=()=>o.classList.contains("disabled")?null:o.classList.add("disabled"),n=()=>o.classList.contains("disabled")?o.classList.remove("disabled"):null,b=()=>{d.classList.contains("d-none")&&d.classList.remove("d-none")},E=e=>{e.disabled=!0;let a=e.innerHTML;e.innerHTML='<span class="spinner-border spinner-border-sm my-0 mx-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>';let h=async()=>{await U.show(),e.disabled=!1,e.innerHTML=a,U.scroll()};return{next:async()=>{f+=i,e.innerHTML="Next"+e.innerHTML,await h(),r.innerText=String(parseInt(r.innerText)+1)},prev:async()=>{f-=i,e.innerHTML=e.innerHTML+"Prev",await h(),r.innerText=String(parseInt(r.innerText)-1)}}};return{init:()=>{d=document.getElementById("pagination"),d.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,r=document.getElementById("page"),m=document.getElementById("previous"),o=document.getElementById("next")},setPer:p,getPer:l,getNext:c,reset:async()=>f===0?!1:(f=0,g=0,r.innerText=1,k(),A(),await U.show(),!0),setResultData:e=>{if(g=e,f>0&&u(),g<i){k();return}n(),b()},getResultData:y,previous:async e=>{A(),!(f<0)&&(k(),await E(e).prev())},next:async e=>{k(),!(g<i)&&(A(),await E(e).next())}}})();var U=(()=>{let i=null,f=null,g=null,r=null,m=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',o=(s,t)=>{document.querySelector(`[data-button-action="${s}"]`).childNodes.forEach(w=>{w.disabled=t})},d=()=>document.getElementById("comments").scrollIntoView({behavior:"smooth"}),p=s=>{s.comments&&s.comments.forEach(p);let t=document.getElementById(`body-content-${s.uuid}`);t.addEventListener("touchend",()=>W.tapTap(t))},l=async s=>{if(!confirm("Are you sure?"))return;let t=s.getAttribute("data-uuid");x.isAdmin()&&i.set(t,s.getAttribute("data-own")),o(t,!0);let w=T.disableButton(s),e=document.querySelector(`[onclick="undangan.comment.like.love(this)"][data-uuid="${t}"]`);if(e.disabled=!0,!await B(X,"/api/comment/"+i.get(t)).token(x.getToken()).send(S.statusResponse).then(v=>v.data.status,()=>!1)){w.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(v=>{let P=v.getAttribute("data-uuids").split(",");if(P.find(q=>q===t)){let q=P.filter(M=>M!==t).join(",");q.length===0?v.remove():v.setAttribute("data-uuids",q)}}),i.unset(t),document.getElementById(t).remove();let h=document.getElementById("comments");h.children.length===0&&(h.innerHTML=m())},c=async s=>{let t=s.getAttribute("data-uuid"),w=!1,e=document.getElementById(`form-inner-presence-${t}`);e&&(e.disabled=!0,w=e.value==="1");let a=document.getElementById(`form-${t?`inner-${t}`:"comment"}`),h=!1,v=document.getElementById(`badge-${t}`);if(v&&(h=v.classList.contains("text-success")),t&&T.base64Encode(a.value)===a.getAttribute("data-original")&&h===w){o(t,!1),document.getElementById(`inner-${t}`).remove();return}a.disabled=!0;let P=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);P&&(P.disabled=!0);let q=T.disableButton(s),M=await B(K,"/api/comment/"+i.get(t)).token(x.getToken()).body(S.updateCommentRequest(e?w:null,a.value)).send(S.statusResponse).then(te=>te.data.status,()=>!1);if(a.disabled=!1,P&&(P.disabled=!1),e&&(e.disabled=!1),q.restore(),!M)return;o(t,!1),document.getElementById(`inner-${t}`).remove();let C=document.querySelector(`[onclick="undangan.comment.showMore(this, '${t}')"]`),I=_.convertMarkdownToHTML(T.escapeHtml(a.value)),z=document.getElementById(`content-${t}`);if(I.length>_.maxCommentLength?(z.innerHTML=C?.getAttribute("data-show")==="false"?I.slice(0,_.maxCommentLength)+"...":I,z.setAttribute("data-comment",T.base64Encode(I)),C?.style.display==="none"&&(C.style.display="block")):(z.innerHTML=I,z.removeAttribute("data-comment"),C?.style.display==="block"&&(C.style.display="none")),e&&(document.getElementById("form-presence").value=w?"1":"2",L("information").set("presence",w)),!(!e||!v)){if(w){v.classList.remove("fa-circle-xmark","text-danger"),v.classList.add("fa-circle-check","text-success");return}v.classList.remove("fa-circle-check","text-success"),v.classList.add("fa-circle-xmark","text-danger")}},y=async s=>{let t=s.getAttribute("data-uuid"),w=document.getElementById("form-name"),e=w.value;if(x.isAdmin()&&(e=f.get("name")),e.length===0){t&&document.getElementById("comment").scrollIntoView({behavior:"smooth"}),alert("Silakan masukkan nama Anda.");return}let a=document.getElementById("form-presence");if(!t&&a&&a.value==="0"){alert("Silakan pilih status kehadiran Anda.");return}!t&&w&&!x.isAdmin()&&(w.disabled=!0),a&&a.value!=="0"&&(a.disabled=!0);let h=document.getElementById(`form-${t?`inner-${t}`:"comment"}`);h.disabled=!0;let v=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);v&&(v.disabled=!0);let P=T.disableButton(s),q=a?a.value==="1":!0;if(!x.isAdmin()){let C=L("information");C.set("name",e),t||C.set("presence",q)}let M=await B(F,"/api/comment").token(x.getToken()).body(S.postCommentRequest(t,e,q,h.value)).send(S.getCommentResponse).then(C=>C,()=>null);if(w&&(w.disabled=!1),h.disabled=!1,v&&(v.disabled=!1),a&&(a.disabled=!1),P.restore(),!(!M||M.code!==V)){if(i.set(M.data.uuid,M.data.own),h.value=null,!t){if(await R.reset()){d();return}let I=document.getElementById("comments");R.setResultData(I.children.length),R.getResultData()===R.getPer()&&I.lastElementChild.remove(),M.data.is_admin=x.isAdmin(),I.innerHTML=_.renderContent(M.data)+I.innerHTML,d()}if(t){r.set("hidden",r.get("hidden").concat([S.commentShowMore(M.data.uuid,!0)])),r.set("show",r.get("show").concat([t])),o(t,!1),document.getElementById(`inner-${t}`).remove(),M.data.is_admin=x.isAdmin(),document.getElementById(`reply-content-${t}`).insertAdjacentHTML("beforeend",_.renderInnerContent(M.data));let C=document.getElementById(`button-${t}`),I=C.querySelector("a"),z=[M.data.uuid];I&&(I.getAttribute("data-show")==="false"&&b(I),I.remove()),C.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${t}"]`).insertAdjacentHTML("beforebegin",_.renderReadMore(t,I?I.getAttribute("data-uuids").split(",").concat(z):z))}p(M.data)}},A=s=>{let t=document.getElementById(`form-inner-${s}`),w=!1,e=document.getElementById(`form-inner-presence-${s}`);e&&(w=e.value==="1");let a=!1,h=document.getElementById(`badge-${s}`);h&&(a=h.classList.contains("text-success")),(t.value.length===0||T.base64Encode(t.value)===t.getAttribute("data-original")&&a===w||confirm("Are you sure?"))&&(o(s,!1),document.getElementById(`inner-${s}`).remove())},u=s=>{let t=s.getAttribute("data-uuid");document.getElementById(`inner-${t}`)||(o(t,!0),document.getElementById(`button-${t}`).insertAdjacentElement("afterend",_.renderReply(t)))},k=async s=>{let t=s.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;o(t,!0);let w=T.disableButton(s);await B(O,"/api/comment/"+t).token(x.getToken()).send(S.commentResponse).then(e=>{if(e.code!==N)return;document.getElementById(`button-${t}`).insertAdjacentElement("afterend",_.renderEdit(t,e.data.presence));let a=document.getElementById(`form-inner-${t}`);a.value=e.data.comment,a.setAttribute("data-original",T.base64Encode(e.data.comment))}),w.restore(),s.disabled=!0},n=()=>{let s=document.getElementById("comments");return s.getAttribute("data-loading")==="false"&&(s.setAttribute("data-loading","true"),s.innerHTML=_.renderLoading().repeat(R.getPer())),B(O,`/api/comment?per=${R.getPer()}&next=${R.getNext()}`).token(x.getToken()).send(S.getCommentsResponse).then(t=>{if(R.setResultData(t.data.length),s.setAttribute("data-loading","false"),t.data.length===0)return s.innerHTML=m(),t;let w=(e,a)=>(e.forEach(h=>{a.find(v=>v.uuid===h.uuid)||a.push(S.commentShowMore(h.uuid)),h.comments&&h.comments.length>0&&w(h.comments,a)}),a);return r.set("hidden",w(t.data,r.get("hidden"))),s.innerHTML=t.data.map(e=>_.renderContent(e)).join(""),t.data.forEach($),t.data.forEach(p),t})},b=s=>{let t=s.getAttribute("data-uuids").split(","),w=s.getAttribute("data-show")==="true",e=s.getAttribute("data-uuid");w?(s.setAttribute("data-show","false"),s.innerText="Show replies",s.innerText+=" ("+t.length+")",r.set("show",r.get("show").filter(a=>a!==e))):(s.setAttribute("data-show","true"),s.innerText="Hide replies",r.set("show",r.get("show").concat([e])));for(let a of t){r.set("hidden",r.get("hidden").map(v=>(v.uuid===a&&(v.show=!w),v)));let h=document.getElementById(a).classList;w?h.add("d-none"):h.remove("d-none")}},E=(s,t)=>{let w=document.getElementById(`content-${t}`),e=T.base64Decode(w.getAttribute("data-comment")),a=s.getAttribute("data-show")==="false";w.innerHTML=a?e:e.slice(0,_.maxCommentLength)+"...",s.innerText=a?"Sebagian":"Selengkapnya",s.setAttribute("data-show",a?"true":"false")},$=s=>{x.isAdmin()&&(s.comments&&s.comments.forEach($),!(s.ip===void 0||s.user_agent===void 0||s.is_admin||g.has(s.ip))&&fetch(`https://freeipapi.com/api/json/${s.ip}`).then(t=>t.json()).then(t=>{let w=t.cityName+" - "+t.regionName;t.cityName==="-"&&t.regionName==="-"&&(w="localhost"),g.set(s.ip,w),document.getElementById(`ip-${s.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(s.ip)} <strong>${w}</strong>`}).catch(t=>{document.getElementById(`ip-${s.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(s.ip)} <strong>${T.escapeHtml(t.message)}</strong>`}))};return{like:W,pagination:R,init:()=>{W.init(),_.init(),R.init(),i=L("owns"),f=L("user"),g=L("tracker"),r=L("comment"),r.has("hidden")||r.set("hidden",[]),r.has("show")||r.set("show",[])},scroll:d,cancel:A,send:y,edit:k,reply:u,remove:l,update:c,show:n,showMore:E,showOrHide:b}})();var ee=(()=>{let i=async()=>{await j.getDetailUser().then(n=>{document.getElementById("dashboard-name").innerHTML=`${T.escapeHtml(n.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=n.data.email,document.getElementById("dashboard-accesskey").value=n.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",n.data.access_key),document.getElementById("form-name").value=T.escapeHtml(n.data.name),document.getElementById("filterBadWord").checked=!!n.data.is_filter,document.getElementById("replyComment").checked=!!n.data.can_reply,document.getElementById("editComment").checked=!!n.data.can_edit,document.getElementById("deleteComment").checked=!!n.data.can_delete}),B(O,"/api/stats").token(x.getToken()).send().then(n=>{document.getElementById("count-comment").innerHTML=String(n.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(n.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(n.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(n.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),U.show()},f=async n=>{let b=T.disableCheckbox(n);await B(D,"/api/user").token(x.getToken()).body({filter:!!n.checked}).send(),b.restore()},g=async n=>{let b=T.disableCheckbox(n);await B(D,"/api/user").token(x.getToken()).body({can_reply:!!n.checked}).send(),b.restore()},r=async n=>{let b=T.disableCheckbox(n);await B(D,"/api/user").token(x.getToken()).body({can_edit:!!n.checked}).send(),b.restore()},m=async n=>{let b=T.disableCheckbox(n);await B(D,"/api/user").token(x.getToken()).body({can_delete:!!n.checked}).send(),b.restore()},o=async n=>{if(!confirm("Are you sure?"))return;let b=T.disableButton(n);await B(K,"/api/key").token(x.getToken()).send(S.statusResponse).then(E=>{E.data.status&&i()}),b.restore()},d=async n=>{let b=document.getElementById("old_password"),E=document.getElementById("new_password");if(b.value.length===0||E.value.length===0){alert("Password cannot be empty");return}b.disabled=!0,E.disabled=!0;let $=T.disableButton(n),H=await B(D,"/api/user").token(x.getToken()).body({old_password:b.value,new_password:E.value}).send(S.statusResponse).then(s=>s.data.status,()=>!1);$.restore(),b.disabled=!1,E.disabled=!1,H&&(b.value=null,E.value=null,n.disabled=!0,alert("Success change password"))},p=async n=>{let b=document.getElementById("form-name");if(b.value.length===0){alert("Name cannot be empty");return}b.disabled=!0;let E=T.disableButton(n),$=await B(D,"/api/user").token(x.getToken()).body({name:b.value}).send(S.statusResponse).then(H=>H.data.status,()=>!1);b.disabled=!1,E.restore(),$&&(i(),n.disabled=!0,alert("Success change name"))},l=async n=>{let b=T.disableButton(n);await B(O,"/api/download").token(x.getToken()).download(),b.restore()},c=()=>{let n=document.getElementById("button-change-name");n.disabled&&(n.disabled=!1)},y=()=>{let n=document.getElementById("button-change-password"),b=document.getElementById("old_password");n.disabled&&b.value.length!==0&&(n.disabled=!1)},A=()=>{confirm("Are you sure?")&&j.clearSession()},u=()=>{Q.init(),U.init(),J.spyTop(),document.addEventListener("hidden.bs.modal",i);try{let n=x.decode()?.exp;if(!n||n<Date.now()/1e3)throw new Error("Invalid token");i()}catch{j.clearSession()}};return{init:()=>(j.init(),J.init(),x.init(),x.isAdmin()||(L("owns").clear(),L("likes").clear(),L("config").clear(),L("comment").clear(),L("session").clear(),L("information").clear()),window.addEventListener("DOMContentLoaded",u),{util:T,theme:J,comment:U,admin:{auth:j,navbar:Y,logout:A,download:l,regenerate:o,editComment:r,replyComment:g,deleteComment:m,changeName:p,changePassword:d,changeFilterBadWord:f,enableButtonName:c,enableButtonPassword:y}})}})();(i=>{i.undangan=ee.init()})(window);})();
